<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard | StegoSafe</title>

<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


<script>
function toggleSearchResults(show) {
    const box = document.getElementById("searchResults");
    box.style.display = show ? "block" : "none";
}
</script>
</head>

<body class="{{ theme|lower }}-theme">

<!-- ================= NAVBAR ================= -->
<div class="navbar">

    <!-- LEFT -->
    <div class="nav-left">
        <img class="lock-icon"
             src="https://cdn-icons-png.flaticon.com/512/3064/3064197.png"
             onclick="location.href='/dashboard'">
        <h1>StegoSafe</h1>
    </div>

    <!-- CENTER SEARCH -->
    <div class="nav-search">

        <form action="/search" method="POST">
            <input type="text"
                   name="search"
                   placeholder="Search users..."
                   onfocus="toggleSearchResults(true)">
        </form>

        {% if users %}
        <div class="nav-search-results" id="searchResults">
            {% for user in users %}
                {% if user.username != session["user"] %}
                <a href="/chat/{{ user.username }}">
                    <div class="search-user">
                        ðŸ‘¤ {{ user.username }}
                    </div>
                </a>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}

    </div>

    <!-- RIGHT -->
    <div class="nav-right">
        <img class="pfp-small"
             src="{{ pfp }}"
             onclick="location.href='/profile'">

        <span class="account-link"
              onclick="location.href='/profile'">
              {{ username }}
        </span>
    </div>

</div>


<!-- ================= MAIN ================= -->

<div class="dashboard-main">

    <!-- LEFT COLUMN -->
    <div class="chat-list">

        <h3>Recent Chats</h3>

        {% if recent_chats %}
            {% for chat in recent_chats %}
            <a href="/chat/{{ chat.username }}" class="chat-link">

                <div class="chat-row">
                    <img src="{{ chat.pfp }}" class="chat-avatar">

                    <div class="chat-info">
                        <span class="chat-name">{{ chat.username }}</span>
                        <span class="chat-preview">{{ chat.last_msg }}</span>
                    </div>

                </div>

            </a>
            {% endfor %}
        {% else %}
            <p class="no-results">No recent chats.</p>
        {% endif %}

    </div>

    <!-- RIGHT COLUMN -->
    <div class="dashboard-placeholder">
        <h2>Select a chat to start messaging</h2>
        <p>Your conversations appear here.</p>
    </div>

</div>

</body>
</html>
