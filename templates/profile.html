{% extends "base.html" %}

{% block title %}Profile | StegoSafe{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock %}

{% block navbar %}
<!-- Fixed Navbar -->
<nav class="sticky top-0 z-50 px-6 py-4 glass-panel border-b border-white/5 flex-none">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-lg flex items-center justify-center">
                <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Logo"
                    class="w-full h-full object-contain">
            </div>
            <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-brand-300 to-accent-blue">
                Profile Settings
            </h1>
        </div>

        <a href="/dashboard"
            class="flex items-center gap-2 text-sm font-medium text-muted hover:text-brand-400 transition-colors">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Back to Dashboard
        </a>
    </div>
</nav>
</div>
{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<!-- Scrollable Content -->
<div class="flex-1 overflow-y-auto custom-scrollbar relative">
    <div class="min-h-full flex flex-col items-center p-4 py-12 relative">

        <!-- Decorative Background -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-0 right-1/4 w-96 h-96 bg-brand-500/5 rounded-full blur-[120px]"></div>
            <div class="absolute bottom-0 left-1/4 w-96 h-96 bg-purple-500/5 rounded-full blur-[120px]"></div>
        </div>

        <!-- Additional Flash Messages Area (Mobile) -->
        <!-- (Desktop relies on base.html fixed container, but mobile sometimes needs inline) -->

        <div class="w-full max-w-5xl z-10">

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

                <!-- Profile Card -->
                <div class="md:col-span-1">
                    <div class="glass-panel p-6 rounded-2xl flex flex-col items-center text-center h-full shadow-lg">
                        <div class="relative group mb-6">
                            <img id="avatarPreview" src="{{ pfp }}"
                                class="w-36 h-36 rounded-full object-cover border-4 border-slate-200 dark:border-slate-700 group-hover:border-brand-500 transition-colors shadow-2xl">

                            <label
                                class="absolute inset-0 flex items-center justify-center bg-black/50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                                <div class="flex flex-col items-center text-white">
                                    <svg class="w-8 h-8 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                    <span class="text-xs font-bold uppercase tracking-wide">Change</span>
                                </div>
                                <form action="/upload-avatar" method="POST" enctype="multipart/form-data">
                                    <input type="file" name="avatar" hidden onchange="this.form.submit()">
                                </form>
                            </label>
                        </div>

                        <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-1">{{ session['user'] }}
                        </h2>
                        <p class="text-sm text-brand-400 font-medium mb-8">Encrypted & Secure</p>

                        <div class="w-full h-px bg-slate-200 dark:bg-slate-700/50 mb-6"></div>

                        <div class="w-full text-left space-y-4">
                            <div class="p-3 bg-white/50 default-bg-subtle dark:bg-slate-800/50 rounded-xl">
                                <span
                                    class="text-xs font-bold text-slate-500 uppercase tracking-wider block mb-1">Bio</span>
                                <p class="text-slate-700 dark:text-slate-300 text-sm leading-relaxed">{{ bio or 'No
                                    bio set'
                                    }}</p>
                            </div>
                            <div
                                class="p-3 bg-white/50 default-bg-subtle dark:bg-slate-800/50 rounded-xl flex items-center justify-between">
                                <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">Status</span>
                                <div class="flex items-center gap-2">
                                    <span class="w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse"></span>
                                    <p class="text-slate-700 dark:text-slate-300 text-sm font-medium">Online</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="md:col-span-2 space-y-6">

                    <!-- Edit Profile Info -->
                    <div class="glass-panel p-6 rounded-2xl shadow-lg">
                        <h3
                            class="text-lg font-bold text-slate-800 dark:text-white mb-6 flex items-center gap-2 border-b border-slate-200 dark:border-slate-700 pb-4">
                            <svg class="w-5 h-5 text-brand-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                            Edit Information
                        </h3>

                        <form action="/update-profile" method="POST" class="space-y-6">
                            <div>
                                <label
                                    class="block text-sm font-bold text-slate-500 dark:text-slate-400 mb-2 uppercase tracking-wide">Bio</label>
                                <textarea name="bio" rows="3"
                                    class="w-full glass-input p-4 rounded-xl focus:ring-1 focus:ring-brand-500 text-slate-800 dark:text-slate-200 placeholder-slate-400">{{ bio }}</textarea>
                            </div>

                            <div>
                                <label
                                    class="block text-sm font-bold text-slate-500 dark:text-slate-400 mb-3 uppercase tracking-wide">Interface
                                    Theme</label>
                                <div class="grid grid-cols-3 gap-4">
                                    <!-- Default (Purple) -->
                                    <label class="cursor-pointer group relative">
                                        <input type="radio" name="theme" value="Default" class="peer sr-only" {% if
                                            theme=='Default' or not theme %}checked{% endif %}>
                                        <div
                                            class="p-4 rounded-2xl border-2 border-transparent bg-gradient-to-br from-indigo-950 to-violet-900 peer-checked:border-violet-500 shadow-sm hover:shadow-md transition-all">
                                            <div
                                                class="w-full h-8 rounded-lg bg-gradient-to-r from-violet-600 to-indigo-500 mb-2">
                                            </div>
                                            <span
                                                class="text-sm font-bold text-slate-300 text-center block">Default</span>
                                        </div>
                                        <div
                                            class="absolute -top-2 -right-2 bg-purple-500 text-white rounded-full p-1 shadow-md opacity-0 peer-checked:opacity-100 transition-opacity scale-0 peer-checked:scale-100">
                                            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                    d="M5 13l4 4L19 7" />
                                            </svg>
                                        </div>
                                    </label>

                                    <!-- Light (Professional) -->
                                    <label class="cursor-pointer group relative">
                                        <input type="radio" name="theme" value="Light" class="peer sr-only" {% if
                                            theme=='Light' %}checked{% endif %}>
                                        <div
                                            class="p-4 rounded-2xl border-2 border-transparent bg-slate-100 peer-checked:border-slate-400 shadow-sm hover:shadow-md transition-all">
                                            <div class="w-full h-8 rounded-lg bg-white border border-slate-200 mb-2">
                                            </div>
                                            <span
                                                class="text-sm font-bold text-slate-600 default-text-dark text-center block">Light</span>
                                        </div>
                                        <div
                                            class="absolute -top-2 -right-2 bg-slate-500 text-white rounded-full p-1 shadow-md opacity-0 peer-checked:opacity-100 transition-opacity scale-0 peer-checked:scale-100">
                                            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                    d="M5 13l4 4L19 7" />
                                            </svg>
                                        </div>
                                    </label>

                                    <!-- Dark (Slate) -->
                                    <label class="cursor-pointer group relative">
                                        <input type="radio" name="theme" value="Dark" class="peer sr-only" {% if
                                            theme=='Dark' %}checked{% endif %}>
                                        <div
                                            class="p-4 rounded-2xl border-2 border-transparent bg-slate-900 peer-checked:border-brand-500 shadow-sm hover:shadow-md transition-all">
                                            <div
                                                class="w-full h-8 rounded-lg bg-slate-800 border border-slate-700 mb-2">
                                            </div>
                                            <span class="text-sm font-bold text-slate-300 text-center block">Dark</span>
                                        </div>
                                        <div
                                            class="absolute -top-2 -right-2 bg-brand-500 text-white rounded-full p-1 shadow-md opacity-0 peer-checked:opacity-100 transition-opacity scale-0 peer-checked:scale-100">
                                            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                    d="M5 13l4 4L19 7" />
                                            </svg>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="flex justify-end pt-2">
                                <button type="submit"
                                    class="px-8 py-3 bg-brand-500 text-white font-bold rounded-xl shadow-lg shadow-brand-500/30 hover:bg-brand-600 hover:scale-[1.02] transition-all">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Security -->
                    <div class="glass-panel p-6 rounded-2xl shadow-lg">
                        <h3
                            class="text-lg font-bold text-slate-800 dark:text-white mb-6 flex items-center gap-2 border-b border-slate-200 dark:border-slate-700 pb-4">
                            <svg class="w-5 h-5 text-brand-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                            </svg>
                            Security & Danger Zone
                        </h3>

                        <div class="space-y-8">
                            <!-- Change Password -->
                            <form action="/change-password" method="POST" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label
                                            class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Current
                                            Password</label>
                                        <input type="password" name="current_password" required
                                            class="w-full glass-input p-3 rounded-xl focus:ring-1 focus:ring-brand-500">
                                    </div>
                                    <div>
                                        <label
                                            class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">New
                                            Password</label>
                                        <input type="password" name="new_password" required minlength="8"
                                            class="w-full glass-input p-3 rounded-xl focus:ring-1 focus:ring-brand-500">
                                    </div>
                                </div>
                                <div class="flex justify-end">
                                    <button
                                        class="px-5 py-2 bg-slate-200 dark:bg-slate-700 text-slate-800 default-text-dark dark:text-stone-300 font-semibold rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors text-sm">
                                        Update Password
                                    </button>
                                </div>
                            </form>

                            <!-- Delete Account -->
                            <div class="glass-panel p-4 rounded-xl border-l-4 border-red-500 shadow-lg">
                                <h4 class="font-bold text-red-500 mb-2">Delete Account</h4>
                                <p class="text-sm text-slate-600 dark:text-slate-300 mb-4 opacity-80">
                                    Once you delete your account, there is no going back. Please be certain.
                                </p>

                                <details class="group">
                                    <summary
                                        class="inline-flex items-center gap-2 cursor-pointer text-red-500 hover:text-red-400 font-bold underline decoration-2 underline-offset-4 transition-colors">
                                        I understand, show delete option
                                        <svg class="w-4 h-4 transition-transform group-open:rotate-180" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </summary>
                                    <div class="mt-4 animate-fade-in">
                                        <form id="deleteForm" action="/delete-account" method="POST">
                                            <button type="button" onclick="confirmDelete()"
                                                class="w-full py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl shadow-lg shadow-red-500/30 transition-all transform hover:scale-[1.01]">
                                                Yes, Permanently Delete My Account
                                            </button>
                                        </form>
                                    </div>
                                </details>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        {% endblock %}

        {% block scripts %}
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            function confirmDelete() {
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this! Your account and all data will be permanently deleted.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    cancelButtonColor: '#64748b',
                    confirmButtonText: 'Yes, delete it!',
                    background: document.documentElement.classList.contains('dark') ? '#1e293b' : '#ffffff',
                    color: document.documentElement.classList.contains('dark') ? '#f1f5f9' : '#0f172a'
                }).then((result) => {
                    if (result.isConfirmed) {
                        document.getElementById('deleteForm').submit();
                    }
                })
            }
        </script>
        {% endblock %}